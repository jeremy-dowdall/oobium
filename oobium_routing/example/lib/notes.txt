
Primary Router(all parsers
    |
    \-Child
    |   |
    |   \-Child
    |   |
    |   \-Child
    |
    \-Child

Router
  RouterDelegate
    Routes (definitions)
    State

State has 3 interfaces:
 - getPages (turn stack into a list of pages, relative to this router)
 - get/set stack (maintain a history of routes; local or global?)
 - update top-level app route (update the global app route upon changes)

1 Route can span many Routers (/books/1 spans 2: /books & /books/<id>)

Routes has 3 jobs
 - route definitions
 - route parsers (if top-level)
 - home

top-level, app routes:
  /
  /authors
  /authors/1
  /books
  /books/1
  /books/1/chapters
  /books/1/chapters/2
  /books/1/chapters/2/verses
  /books/1/chapters/2/verses/3
widgets:
  MaterialApp.router
    authorsRouter
    booksRouter:      home: /books, bookRoute: /books/<id>
      chaptersRouter: home: /books/<id>/chapters, chapterRoute: /books/<id>/chapters/<id>)
        versesRouter: home: /books/<id>/chapters/<id>/verses, bookRoute: /books/<id>/chapters/<id>/verses/<id>)

Router1-ActiveChild:2.1
  Router2.1-ActiveChild:3.1
    Router3.1-Active
    Router3.2
  Router2.2
    Router4.1
    Router4.2

Primary Router receives web url and deep links, thus it needs all parsers

Application Home is in the Primary Router
 - is this a redirect? a render view? a render other route?

routes._home is a route that will overwrite the setting of state.route
 - state.route = HomeRoute() becomes state.route = routes._home

if routes._home is not set, then state.route = HomeRoute() is maintained
 and the RouterDelegate's getPages method will have to deal with it...
 - this means HomeRoute will need to be in (local) routes definitions
   - this means that each Router can have a HomeRoute definition
     - this HomeRoute definition is the 'at' route

State
 - current configuration (whole app - there is no 'relative to router')
 - 'special routes' (home|404|500) are causing problems... especially home
 - child routers should not have a HomeRoute?
 - set state send the change up to the top and it trickles back down?
   - local state changes don't update the app url (web) or appBar back button (ios)
   - state.route and state.localRoute ?
 - why a state object for each router?
   - because children will maintain different backstacks (tree)

State
 - routes are full, global paths
 - relevant parts are pulled off by each router
 - each router keeps its own stack (but they are still all global routes)
 - when the primary route is set, it may need to update it's children
   - they should all get a look at it
 - when a child route is set...
   - should these all be set top-down?
   - else there's a chance of setting a route for child that doesn't support it
     - like calling context.route = BookRoute(id: '123') when in authorsRoutes
   - context.route = <global route> (bubble up to the primary, if set on a child)
     - set on the primary router state, even if called on a child router
   - authorsRoutes.pushBookRoute(id: '123') (need to bubble? maybe to update the web url?)
     - set on the child router state (authorsRoutes)
       - authorsRoutes.pop() -> pops last route off of local state stack
       - authorsRoutes.putBookRoute(id: '123') -> overwrites local state route with BookRoute
       - authorsRoutes.setBookRoute(id: '123') -> overwrites all local state with BookRoute
       - authorsRoutes.setHome() -> overwrites all local state with routes._home
     - requires reference to RouterDelegate in the authorsRoutes class...

Stack - each route (AppRoute) represents a full url routing stack
 - toStack returns a List of routes up to (but not including) home
 - this stack is fed to the getPages of each RouterDelegate (primary and children)
 - each RouterDelegate knows it's depth in the stack...

Routes
 - list of routes

Primary Router pages - a stack here adds a appBar back button
Child Router pages - a stack here does not add a appBar back button ('local route')

let's try:
 - children have no state or nothing
 - all pages set by the